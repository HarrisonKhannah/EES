if(!Date.prototype.toISOString) 
{
    Date.prototype.toISOString = function() 
	{
        function pad(n) {return n < 10 ? '0' + n : n}
        return this.getUTCFullYear() + '-'
            + pad(this.getUTCMonth() + 1) + '-'
                + pad(this.getUTCDate()) + 'T'
                    + pad(this.getUTCHours()) + ':'
                        + pad(this.getUTCMinutes()) + ':'
                            + pad(this.getUTCSeconds()) + 'Z';
    };
}
function getRandom(min,max)
{
	return((Math.floor(Math.random()*(max-min)))+min);
}
function onAfterSlide(prevSlide, currentSlide)
{
	var expando = jQuery(this).get(0)[jQuery.expando];
	jQuery("#slider_navigation_" + expando + " .slider_control").addClass("inactive");
	jQuery("#" + jQuery(currentSlide).attr("id") + "_content").fadeIn(200, function(){
		jQuery("#slider_navigation_" + expando + " .slider_control").removeClass("inactive");
	});	
}
function onBeforeSlide(prevSlide, currentSlide)
{
	var expando = jQuery(this).get(0)[jQuery.expando];
	jQuery(".slider_" + expando + "_content_container .slider_content").fadeOut(200);
	var position = jQuery(jQuery("#" + jQuery(currentSlide).attr("id") + "_control")).position();
	var positionPrev = jQuery(jQuery("#" + jQuery(prevSlide).attr("id") + "_control")).position();
	jQuery("#slider_navigation_" + expando + " .slider_control_bar").css("display", "none");
	jQuery("#slider_navigation_" + expando + " .slider_bar").css({
		"display": "block",
		"margin-left": positionPrev.left + "px"
	});
	jQuery("#slider_navigation_" + expando + " .slider_bar").animate({
		'margin-left': position.left + "px"
	}, 750, "easeInOutQuint", function(){
		jQuery(this).css("display", "none");
		jQuery("#" + jQuery(currentSlide).attr("id") + "_control").children("#slider_navigation_" + expando + " .slider_control_bar").css("display", "block");
	});
}
var map = null;
jQuery(document).ready(function(jQuery){
	//mobile menu
	jQuery(".mobile_menu select").change(function(){
		window.location.href = jQuery(this).val();
		return;
	});
	
	//slider
	jQuery(".slider").carouFredSel({
		responsive: true,
		prev: {
			onAfter: onAfterSlide,
			onBefore: onBeforeSlide,
			easing: "easeInOutQuint",
			duration: 750
		},
		next: {
			onAfter: onAfterSlide,
			onBefore: onBeforeSlide,
			easing: "easeInOutQuint",
			duration: 750
		},
		auto: {
			play: true,
			pauseDuration: 5000,
			onAfter: onAfterSlide,
			onBefore: onBeforeSlide,
			easing: "easeInOutQuint",
			duration: 750
		}
	},
	{
		wrapper: {
			classname: "caroufredsel_wrapper caroufredsel_wrapper_slider"
		}
	});
	jQuery(".slider").sliderControl({
		appendTo: jQuery(".slider_content_box"),
		contentContainer: jQuery(".slider_content_box")
	});
	
	//image carousel
	//image carousel with preloader
	var imageCarousel = function()
	{
		jQuery(".image_carousel").each(function(index){
			jQuery(this).addClass("mc_preloader_" + index);
			jQuery(".mc_preloader_" + index + " img:first").attr('src',jQuery(".mc_preloader_" + index + " img:first").attr('src') + '?i='+getRandom(1,100000));
			jQuery(".mc_preloader_" + index + " img:first").one("load", function(){
				jQuery(this).prev(".mc_preloader").remove();
				jQuery(this).fadeIn();
				var carouselOptions = {
					responsive: true,
					prev: {
						onAfter: onAfterSlide,
						onBefore: onBeforeSlide,
						easing: "easeInOutQuint",
						duration: 750
					},
					next: {
						onAfter: onAfterSlide,
						onBefore: onBeforeSlide,
						easing: "easeInOutQuint",
						duration: 750
					},
					auto: {
						play: false,
						pauseDuration: 5000,
						onAfter: onAfterSlide,
						onBefore: onBeforeSlide,
						easing: "easeInOutQuint",
						duration: 750
					}
				};
				jQuery(".mc_preloader_" + index).carouFredSel(carouselOptions);
				if(jQuery(".mc_preloader_" + index).children().length>1)
				{
					jQuery(".mc_preloader_" + index).sliderControl({
						appendTo: "",
						contentContainer: ""
					});
				}
				jQuery(".mc_preloader_" + index + " li img").css("display", "block");
				jQuery(".mc_preloader_" + index).trigger("updateSizesCustom"); //for width
				jQuery(".mc_preloader_" + index).trigger("updateSizesCustom"); //for height
			}).each(function(){
				if(this.complete) 
					jQuery(this).load();
			});
		});
	};
	imageCarousel();
	
	/*jQuery("ul.gallery_item_details_list").css({
		"height": 0,
		"display": "none"
	});
	jQuery(".gallery_item_details_list li.gallery_item_details").css("display", "none");*/
	
	//horizontal carousel
	jQuery(".horizontal_carousel").carouFredSel({
		items: {
			visible: 4
		},
		scroll: {
			items: 1,
			easing: "swing",
			pauseOnHover: true
		},
		auto: {
			play: false,
			items: 1
		}
	});
	jQuery(".our_clinic").trigger("configuration", {
		prev: '#our_clinic_prev',
		next: '#our_clinic_next'
	});
	jQuery(".carousel").trigger("configuration", {
		prev: '#carousel_prev',
		next: '#carousel_next'
	});
	setTimeout(function(){
		jQuery(".testimonials").trigger("configuration", {
			items: {
				visible: 2
			},
			prev: '#testimonials_prev',
			next: '#testimonials_next'
		});
	}, 1000);
	
	//training_classes
	jQuery(".accordion").accordion({
		event: 'change',
		autoHeight: false/*,
		active: false,
		collapsible: true*/
	});
	jQuery(".accordion.wide").bind("accordionchange", function(event, ui){
		jQuery("html, body").animate({scrollTop: jQuery("#"+jQuery(ui.newHeader).attr("id")).offset().top}, 400);
	});
	jQuery(".tabs").bind("tabsbeforeactivate", function(event, ui){
		jQuery("html, body").animate({scrollTop: jQuery("#"+jQuery(ui.newTab).children("a").attr("id")).offset().top}, 400);
	});
	jQuery(".tabs").tabs({
		event: 'change',
		show: true,
		create: function(){
			jQuery("html, body").scrollTop(0);
		}
	});
	
	//image controls
	var currentControls;
	jQuery(".gallery_box").hover(function(){
		var width = jQuery(this).find("img").first().width();
		var height = jQuery(this).find("img").first().height();
		currentControls = jQuery(this).find(".controls");
		var currentControlsWidth = currentControls.outerWidth();
		var currentControlsHeight = currentControls.outerHeight();
		currentControls.stop();
		currentControls.css({
			"display": "block",
			"margin-left": (width/2-currentControlsWidth/2) + "px",
			"top": (height) + "px"
		});
		currentControls.animate({"top": (height/2-currentControlsHeight/2) + "px"},250,'easeInOutCubic');		
	},function(){
		currentControls.stop();
		currentControls.css("display", "block");
		var height = jQuery(this).find("img").first().height();
		currentControls.animate({"top": (height) + "px"},250,'easeInOutCubic', function(){
			jQuery(this).css("display","none");
		});
	});
	
	
	//scroll top
	jQuery("a[href='#top']").click(function() {
		jQuery("html, body").animate({scrollTop: 0}, "slow");
		return false;
	});
	
	//comments number scroll
	jQuery(".single .comments_number").click(function(event){
		event.preventDefault();
		var offset = jQuery("#comments_list").offset();
		jQuery("html, body").animate({scrollTop: offset.top-10}, 400);
	});
	
	//reply button scroll
	jQuery(".reply_button").click(function(event){
		event.preventDefault();
		var offset = jQuery("#comment_form").offset();
		jQuery("html, body").animate({scrollTop: offset.top-10}, 400);
		jQuery("#cancel_comment").css('display', 'block');
	});
	
	//cancel comment button
	jQuery("#cancel_comment").click(function(event){
		event.preventDefault();
		jQuery(this).css('display', 'none');
	});
	
	
	
	
	
	//contact form
	if(jQuery(".contact_form").length)
		jQuery(".contact_form")[0].reset();
	jQuery(".contact_form").submit(function(event){
		event.preventDefault();
		var data = jQuery(this).serializeArray();
		jQuery("#contact_form .block").block({
			message: false,
			overlayCSS: {
				opacity:'0.3',
				"backgroundColor": "#FFF"
			}
		});
		jQuery.ajax({
			url: jQuery(".contact_form").attr("action"),
			data: data,
			type: "post",
			dataType: "json",
			success: function(json){
				jQuery("#contact_form [name='submit'], #contact_form [name='first_name'], #contact_form [name='last_name'], #contact_form [name='email'], #contact_form [name='message']").qtip('destroy');
				if(typeof(json.isOk)!="undefined" && json.isOk)
				{
					if(typeof(json.submit_message)!="undefined" && json.submit_message!="")
					{
						jQuery("#contact_form [name='submit']").qtip(
						{
							style: {
								classes: 'ui-tooltip-success'
							},
							content: { 
								text: json.submit_message 
							},
							position: { 
								my: "right center",
								at: "left center" 
							}
						}).qtip('show');
						jQuery(".contact_form")[0].reset();
						jQuery(".contact_form [name='department']").val("");
						jQuery(".contact_form .tabs_box_navigation_selected>span").text("Select department");
					}
				}
				else
				{
					if(typeof(json.submit_message)!="undefined" && json.submit_message!="")
					{
						jQuery("#contact_form [name='submit']").qtip(
						{
							style: {
								classes: 'ui-tooltip-error'
							},
							content: { 
								text: json.submit_message 
							},
							position: { 
								my: "right center",
								at: "left center" 
							}
						}).qtip('show');
					}
					if(typeof(json.error_first_name)!="undefined" && json.error_first_name!="")
					{
						jQuery("#contact_form [name='first_name']").qtip(
						{
							style: {
								classes: 'ui-tooltip-error'
							},
							content: { 
								text: json.error_first_name 
							},
							position: { 
								my: "bottom center",
								at: "top center" 
							}
						}).qtip('show');
					}
					if(typeof(json.error_last_name)!="undefined" && json.error_last_name!="")
					{
						jQuery("#contact_form [name='last_name']").qtip(
						{
							style: {
								classes: 'ui-tooltip-error'
							},
							content: { 
								text: json.error_last_name 
							},
							position: { 
								my: "bottom center",
								at: "top center" 
							}
						}).qtip('show');
					}
					if(typeof(json.error_email)!="undefined" && json.error_email!="")
					{
						jQuery("#contact_form [name='email']").qtip(
						{
							style: {
								classes: 'ui-tooltip-error'
							},
							content: { 
								text: json.error_email 
							},
							position: { 
								my: "bottom center",
								at: "top center" 
							}
						}).qtip('show');
					}
					if(typeof(json.error_message)!="undefined" && json.error_message!="")
					{
						jQuery("#contact_form [name='message']").qtip(
						{
							style: {
								classes: 'ui-tooltip-error'
							},
							content: { 
								text: json.error_message 
							},
							position: { 
								my: "bottom center",
								at: "top center" 
							}
						}).qtip('show');
					}
				}
				jQuery("#contact_form").unblock();
			}
		});
	});
	//translation
	/*
	jQuery.datepicker.regional['fr'] = {
		renderer: jQuery.ui.datepicker.defaultRenderer,
		monthNames: ['Janvier','Février','Mars','Avril','Mai','Juin',
		'Juillet','Août','Septembre','Octobre','Novembre','Décembre'],
		monthNamesShort: ['Jan','Fév','Mar','Avr','Mai','Jun',
		'Jul','Aoû','Sep','Oct','Nov','Déc'],
		dayNames: ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],
		dayNamesShort: ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'],
		dayNamesMin: ['Di','Lu','Ma','Me','Je','Ve','Sa'],
		dateFormat: 'dd/mm/yyyy',
		firstDay: 1,
		prevText: '&#x3c;Préc', prevStatus: 'Voir le mois précédent',
		prevJumpText: '&#x3c;&#x3c;', prevJumpStatus: 'Voir l\'année précédent',
		nextText: 'Suiv&#x3e;', nextStatus: 'Voir le mois suivant',
		nextJumpText: '&#x3e;&#x3e;', nextJumpStatus: 'Voir l\'année suivant',
		currentText: 'Courant', currentStatus: 'Voir le mois courant',
		todayText: 'Aujourd\'hui', todayStatus: 'Voir aujourd\'hui',
		clearText: 'Effacer', clearStatus: 'Effacer la date sélectionnée',
		closeText: 'Fermer', closeStatus: 'Fermer sans modifier',
		yearStatus: 'Voir une autre année', monthStatus: 'Voir un autre mois',
		weekText: 'Sm', weekStatus: 'Semaine de l\'année',
		dayStatus: '\'Choisir\' le DD d MM',
		defaultStatus: 'Choisir la date',
		isRTL: false
	};
	jQuery.datepicker.setDefaults(jQuery.datepicker.regional['fr']);*/
	jQuery(".contact_form [name='date_of_birth']").datepicker({
		dateFormat: "mm-dd-yy"
	});
	jQuery(".closing_in").each(function(){
		var self = jQuery(this);
		var time = parseInt(self.children(".seconds").text());
		var id = setInterval(function(){
			time--;
			self.children(".seconds").text(time);
			if(time==0)
			{
				self.parent().prev(".notification_box").fadeOut(500, function(){
					jQuery(this).remove();
				});
				self.remove();
				clearInterval(id);
			}
		}, 1000);
	});
	
	function animateElements()
	{
		jQuery('.animated_element').each(function(){
			var elementPos = jQuery(this).offset().top;
			var topOfWindow = jQuery(window).scrollTop();
			if(elementPos<topOfWindow+jQuery(window).height()-20) 
			{
				var elementClasses = jQuery(this).attr('class').split(' ');
				var animation = "fadeIn";
				var duration = 600;
				var delay = 0;
				for(var i=0; i<elementClasses.length; i++)
				{
					if(elementClasses[i].indexOf('animation-')!=-1)
						animation = elementClasses[i].replace('animation-', '');
					if(elementClasses[i].indexOf('duration-')!=-1)
						duration = elementClasses[i].replace('duration-', '');
					if(elementClasses[i].indexOf('delay-')!=-1)
						delay = elementClasses[i].replace('delay-', '');
				}
				jQuery(this).addClass(animation);
				jQuery(this).css({"animation-duration": duration + "ms"});
				jQuery(this).css({"animation-delay": delay + "ms"});
				jQuery(this).css({"transition-delay": delay + "ms"});
			}
		});
		jQuery('.box_header').each(function(){
			var elementPos = jQuery(this).offset().top;
			var topOfWindow = jQuery(window).scrollTop();
			if(elementPos<topOfWindow+jQuery(window).height()-30) 
			{
				jQuery(this).addClass("slide");
			}
		});
	}
	animateElements();
	jQuery(window).scroll(animateElements);
});